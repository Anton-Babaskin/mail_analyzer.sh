# Mail Log Domain Analyzer üìß

[![ShellCheck](https://img.shields.io/badge/ShellCheck-passed-green)](https://github.com/koalaman/shellcheck) [![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT) [![Made with Bash](https://img.shields.io/badge/Made%20with-Bash-1f425f.svg)](https://www.gnu.org/software/bash/)

–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π Bash-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤ –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–æ–≥–∏ Postfix (`/var/log/mail.log*`) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –¥–æ–º–µ–Ω–∞–º, IP-–∞–¥—Ä–µ—Å–∞–º, –º–∞—Ä—à—Ä—É—Ç–∞–º, —Ä–∞–∑–º–µ—Ä–∞–º –ø–∏—Å–µ–º –∏ –æ—à–∏–±–∫–∞–º –¥–æ—Å—Ç–∞–≤–∫–∏.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **–ê–Ω–∞–ª–∏–∑ –¥–æ–º–µ–Ω–æ–≤**: –¢–æ–ø-100 –≤—Ö–æ–¥—è—â–∏—Ö –∏ –∏—Å—Ö–æ–¥—è—â–∏—Ö –¥–æ–º–µ–Ω–æ–≤
- **–ê–Ω–∞–ª–∏–∑ relay-—Å–µ—Ä–≤–µ—Ä–æ–≤**: IP-–∞–¥—Ä–µ—Å–∞ –∏ —Ö–æ—Å—Ç–Ω–µ–π–º—ã —Å–µ—Ä–≤–µ—Ä–æ–≤-–ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–≤
- **–ú–∞—Ä—à—Ä—É—Ç—ã –ø–∏—Å–µ–º**: –ü–æ–ª–Ω—ã–µ –ø—É—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ (–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å ‚Üí –ø–æ–ª—É—á–∞—Ç–µ–ª—å ‚Üí relay)
- **–ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–æ–≤**: –û–±—ä–µ–º—ã —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ —Å—Ä–µ–¥–Ω–∏–µ —Ä–∞–∑–º–µ—Ä—ã –ø–∏—Å–µ–º –ø–æ –¥–æ–º–µ–Ω–∞–º
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫**: –ù–µ—É–¥–∞—á–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –æ—Ç—Å–∫–æ–∫–∏

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã ‚è∞
- `--today` - —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –ø–∏—Å—å–º–∞
- `--last-hour` - –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å  
- `--last-24h` - –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞

### –§–æ—Ä–º–∞—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞ üìä
- **–û–±—ã—á–Ω—ã–π –≤—ã–≤–æ–¥** - –∫—Ä–∞—Å–∏–≤–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- **CSV** - –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤ Excel/Google Sheets
- **JSON** - –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- –†–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–∂–∞—Ç—ã–º–∏ –∏ –Ω–µ—Å–∂–∞—Ç—ã–º–∏ –ª–æ–≥-—Ñ–∞–π–ª–∞–º–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ª–æ–≥–æ–≤ Postfix
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤, —Å–∫–æ–±–æ–∫)

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–û–°**: Linux/Unix —Å Bash
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - `zcat` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∂–∞—Ç—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
  - `awk` - –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –ª–æ–≥–æ–≤  
  - `sort`, `head` - –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—ã–≤–æ–¥–∞
  - `date` - –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
- **–§–∞–π–ª—ã –ª–æ–≥–æ–≤**: –î–æ—Å—Ç—É–ø –∫ `/var/log/mail.log*`
- **–ü—Ä–∞–≤–∞**: –ü—Ä–∞–≤–∞ —á—Ç–µ–Ω–∏—è –ª–æ–≥-—Ñ–∞–π–ª–æ–≤ (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è `sudo`)

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**:
```bash
git clone https://github.com/Anton-Babaskin/mail_analyzer.sh.git
cd mail_analyzer.sh
```

2. **–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º**:
```bash
chmod +x mail_analyzer.sh
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–ø—Ä–∞–≤–∫–∞
```bash
./mail_analyzer.sh help
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### –ê–Ω–∞–ª–∏–∑ –¥–æ–º–µ–Ω–æ–≤
```bash
# –¢–æ–ø-100 –≤—Ö–æ–¥—è—â–∏—Ö –¥–æ–º–µ–Ω–æ–≤
./mail_analyzer.sh in

# –¢–æ–ø-100 –∏—Å—Ö–æ–¥—è—â–∏—Ö –¥–æ–º–µ–Ω–æ–≤  
./mail_analyzer.sh out
```

#### –ê–Ω–∞–ª–∏–∑ relay-—Å–µ—Ä–≤–µ—Ä–æ–≤
```bash
# Relay-—Å–µ—Ä–≤–µ—Ä—ã –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö –ø–∏—Å–µ–º
./mail_analyzer.sh relay_in

# Relay-—Å–µ—Ä–≤–µ—Ä—ã –¥–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –ø–∏—Å–µ–º
./mail_analyzer.sh relay_out
```

#### üÜï –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
```bash
# –¢–æ–ø –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø–∏—Å–µ–º
./mail_analyzer.sh routes

# –¢–æ–ø –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π –ø–æ –æ–±—ä–µ–º—É –¥–∞–Ω–Ω—ã—Ö (–ú–ë)
./mail_analyzer.sh sizes

# –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –ø–∏—Å–µ–º –ø–æ –¥–æ–º–µ–Ω–∞–º (–ö–ë)
./mail_analyzer.sh avg_sizes

# –ù–µ—É–¥–∞—á–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏
./mail_analyzer.sh failed

# –û—Ç—Å–∫–æ–∫–∏ –ø–∏—Å–µ–º
./mail_analyzer.sh bounced
```

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã

```bash
# –¢–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –ø–∏—Å—å–º–∞
./mail_analyzer.sh in --today

# –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
./mail_analyzer.sh routes --last-hour

# –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
./mail_analyzer.sh sizes --last-24h
```

### –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

```bash
# –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
./mail_analyzer.sh in --today --csv

# –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
./mail_analyzer.sh routes --last-24h --json

# –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤
./mail_analyzer.sh sizes --last-hour --json
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞

### –í—Ö–æ–¥—è—â–∏–µ –¥–æ–º–µ–Ω—ã
```
=== –¢–û–ü-100 –í–•–û–î–Ø–©–ò–• –î–û–ú–ï–ù–û–í ===
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –î–æ–º–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
-----------|-------------------
68         | mx1.llc-nsc.ru
59         | mx1.rwsp.ru
57         | mail.oilrusi.ru
```

### –ú–∞—Ä—à—Ä—É—Ç—ã –ø–∏—Å–µ–º
```
=== –¢–û–ü-100 –ú–ê–†–®–†–£–¢–û–í –ü–ò–°–ï–ú ===
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å ‚Üí –ü–æ–ª—É—á–∞—Ç–µ–ª—å ‚Üí Relay
-----------|--------------------------------
25         | gmail.com ‚Üí yandex.ru ‚Üí mx1.yandex.ru
18         | mail.ru ‚Üí gmail.com ‚Üí gmail-smtp-in.l.google.com
```

### –†–∞–∑–º–µ—Ä—ã –ø–∏—Å–µ–º (JSON)
```json
{
  "title": "–¢–û–ü-100 –û–¢–ü–†–ê–í–ò–¢–ï–õ–ï–ô –ü–û –û–ë–™–ï–ú–£ (–ú–ë)",
  "data": [
    {"count": 450, "value": "example.com (1250 –ø–∏—Å–µ–º)"},
    {"count": 320, "value": "mail.ru (890 –ø–∏—Å–µ–º)"}
  ]
}
```

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤**: –°–∫—Ä–∏–ø—Ç —á–∏—Ç–∞–µ—Ç –ª–æ–≥-—Ñ–∞–π–ª—ã —Å –ø–æ–º–æ—â—å—é `zcat` –∏ `awk`
2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –ù–∞—Ö–æ–¥–∏—Ç QID —Å–æ–æ–±—â–µ–Ω–∏–π, —Å–≤—è–∑—ã–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π —Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º–∏
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞**: –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–æ–º–µ–Ω—ã, IP relay-—Å–µ—Ä–≤–µ—Ä–æ–≤, —Ä–∞–∑–º–µ—Ä—ã –ø–∏—Å–µ–º
4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏  
5. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è**: –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
6. **–í—ã–≤–æ–¥**: –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∑–∞–ø—É—Å–∫ –æ—Ç root:
  ```bash
  sudo ./mail_analyzer.sh in
  ```
- **–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤**: –°–∫—Ä–∏–ø—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è Postfix
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ —É–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –ø–∞–º—è—Ç–∏
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã**: –†–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ `date`

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è –ª—é–±—ã–µ —É–ª—É—á—à–µ–Ω–∏—è! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞:
1. –°–æ–∑–¥–∞–π—Ç–µ fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch (`git checkout -b feature/amazing-feature`)
3. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add amazing feature'`)
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ branch (`git push origin feature/amazing-feature`)
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### v2.0.0 (—Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è)
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
- ‚ûï –ê–Ω–∞–ª–∏–∑ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø–∏—Å–µ–º
- ‚ûï –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–∏—Å–µ–º
- ‚ûï –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏
- ‚ûï –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV/JSON
- ‚ûï –î–µ—Ç–∞–ª—å–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞

### v1.0.0
- ‚úÖ –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –≤—Ö–æ–¥—è—â–∏—Ö/–∏—Å—Ö–æ–¥—è—â–∏—Ö –¥–æ–º–µ–Ω–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∂–∞—Ç—ã—Ö –ª–æ–≥–æ–≤
- ‚úÖ –ê–Ω–∞–ª–∏–∑ relay-—Å–µ—Ä–≤–µ—Ä–æ–≤

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ MIT License - –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ —Ñ–∞–π–ª–µ [LICENSE](LICENSE).

## üîó –°—Å—ã–ª–∫–∏

- [GitHub Repository](https://github.com/Anton-Babaskin/mail_analyzer.sh)
- [Issues](https://github.com/Anton-Babaskin/mail_analyzer.sh/issues)
- [Postfix Documentation](http://www.postfix.org/documentation.html)

---

‚≠ê –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –æ–∫–∞–∑–∞–ª—Å—è –ø–æ–ª–µ–∑–Ω—ã–º, –ø–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥–æ—á–∫—É!